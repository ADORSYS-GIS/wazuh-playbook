### SSH Access Restriction Configuration Playbook

**Purpose**:  
Ensure only authorized users/groups can access the system via SSH by configuring `AllowUsers`, `AllowGroups`, `DenyUsers`, or `DenyGroups` in SSH configuration files.

---

#### **Assessment Steps**

1. **Check Current SSH Configuration**  
   Run the command below to check active SSH settings for user/group restrictions:  
   ```bash
   sudo sshd -T | grep -Ei "^\s*(AllowUsers|DenyUsers|AllowGroups|DenyGroups)\s+"
   ```
   - **Compliance**: If any of `AllowUsers`, `DenyUsers`, `AllowGroups`, or `DenyGroups` appear with valid values, no action is needed.  
   - **Non-Compliance**: If no results, proceed to the next steps.

2. **Inspect Main SSH Configuration File**  
   Check `/etc/ssh/sshd_config` for restrictions:  
   ```bash
   sudo grep -Ei "^\s*(AllowUsers|DenyUsers|AllowGroups|DenyGroups)\s+" /etc/ssh/sshd_config
   ```
   - **Compliance**: Directives with valid values exist.  
   - **Non-Compliance**: No results. Proceed to Step 3.

3. **Check Included Configuration Files**  
   Inspect all `.conf` files in `/etc/ssh/sshd_config.d/`:  
   ```bash
   sudo grep -REi "^\s*(AllowUsers|DenyUsers|AllowGroups|DenyGroups)\s+" /etc/ssh/sshd_config.d/*.conf
   ```
   - **Compliance**: Directives found in any file.  
   - **Non-Compliance**: No results. Proceed to remediation.

---

#### **Remediation Steps**

1. **Choose Restriction Method**  
   Select **one** of the following options (examples):  
   - `AllowUsers alice bob@192.168.1.10` (Allow specific users/hosts)  
   - `AllowGroups ssh-users` (Allow a group)  
   - `DenyUsers baduser` (Block specific users)  
   - `DenyGroups restricted` (Block a group)  

2. **Backup Configuration Files**  
   ```bash
   sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
   sudo cp -r /etc/ssh/sshd_config.d/ /etc/ssh/sshd_config.d.bak
   ```

3. **Edit Configuration**  
   **Option A**: Add to `/etc/ssh/sshd_config`  
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```  
   Add your chosen directive (e.g., `AllowUsers alice`).  

   **Option B**: Create a New File in `/etc/ssh/sshd_config.d/`  
   ```bash
   sudo nano /etc/ssh/sshd_config.d/10-restrict-access.conf
   ```  
   Add your chosen directive (e.g., `AllowGroups ssh-users`).  

4. **Test Configuration Syntax**  
   ```bash
   sudo sshd -t
   ```  
   - **Success**: No output. Proceed to Step 5.  
   - **Error**: Fix syntax issues (e.g., typos) before proceeding.

5. **Reload SSH Service**  
   ```bash
   sudo systemctl reload sshd
   ```

6. **Verify Changes**  
   Repeat the **Assessment Steps** to confirm the directives are active.

---

#### **Example Configurations**

1. **Allow Only Specific Users**  
   ```bash
   AllowUsers alice bob@192.168.1.10
   ```

2. **Allow a Group**  
   ```bash
   AllowGroups ssh-users
   ```

3. **Block a User**  
   ```bash
   DenyUsers baduser
   ```

---

#### **Critical Notes**  
- **Test Access**: Ensure your account isnâ€™t locked out. Keep a backup SSH session open during testing.  
- **Precedence**: `DenyUsers`/`DenyGroups` take precedence over `AllowUsers`/`AllowGroups`.  
- **Host-Based Rules**: Use `user@host` syntax to restrict access by source IP (e.g., `bob@192.168.1.10`).

---

**Outcome**: Unauthorized SSH access is blocked, and only approved users/groups can connect.