**Step-by-Step Playbook: Configuring Audit Rules for System Network Environment Monitoring**

**Objective:**  
Implement audit rules to monitor changes to system hostname, domainname, and critical network configuration files/directories.

**Scope:**  
Applies to Linux systems using `auditd`. Covers both 32-bit and 64-bit architectures.

**Prerequisites:**  
- Root/sudo access.
- `auditd` installed and running.
- Basic familiarity with command-line editors (e.g., `nano`, `vi`).

---

### **Step 1: Determine System Architecture**
**Purpose:** Ensure correct audit rules for 32-bit or 64-bit systems.  
**Command:**  
```bash
uname -m
```  
**Expected Output:**  
- `x86_64` → 64-bit system.  
- `i686` or `i386` → 32-bit system.  

---

### **Step 2: Create Audit Rules File**
**Purpose:** Create a dedicated audit rule file to monitor network environment changes.  

1. **Navigate to the rules directory:**  
   ```bash
   cd /etc/audit/rules.d/
   ```

2. **Create or edit a rules file (e.g., `50-system_local.rules`):**  
   ```bash
   sudo nano 50-system_local.rules
   ```

3. **Add the following rules:**  
   - **For 64-bit systems (x86_64):**  
     ```bash
     -a always,exit -F arch=b64 -S sethostname,setdomainname -k system-locale
     -a always,exit -F arch=b32 -S sethostname,setdomainname -k system-locale
     -w /etc/issue -p wa -k system-locale
     -w /etc/issue.net -p wa -k system-locale
     -w /etc/hosts -p wa -k system-locale
     -w /etc/networks -p wa -k system-locale
     -w /etc/network/ -p wa -k system-locale
     ```
   - **For 32-bit systems (i686/i386):**  
     ```bash
     -a always,exit -F arch=b32 -S sethostname,setdomainname -k system-locale
     -w /etc/issue -p wa -k system-locale
     -w /etc/issue.net -p wa -k system-locale
     -w /etc/hosts -p wa -k system-locale
     -w /etc/networks -p wa -k system-locale
     -w /etc/network/ -p wa -k system-locale
     ```

4. **Save and exit the editor.**

---

### **Step 3: Load Audit Rules**
**Purpose:** Apply the new rules without rebooting (if possible).  
**Command:**  
```bash
sudo augenrules --load
```

---

### **Step 4: Check if Reboot is Required**
**Purpose:** Some systems require a reboot to activate audit rules.  
**Command:**  
```bash
if [[ $(auditctl -s | grep "enabled") =~ "2" ]]; then echo "Reboot required"; else echo "No reboot needed"; fi
```  
**Action:**  
- If output is `Reboot required`, restart the system:  
  ```bash
  sudo reboot
  ```

---

### **Step 5: Verify Active Audit Rules**
**Purpose:** Confirm all rules are loaded and match the requirements.  

1. **Check `sethostname` and `setdomainname` monitoring:**  
   ```bash
   sudo auditctl -l | grep -E "sethostname|setdomainname" | grep "system-locale"
   ```  
   **Expected Output:**  
   ```bash
   -a always,exit -F arch=b64 -S sethostname,setdomainname -F key=system-locale
   -a always,exit -F arch=b32 -S sethostname,setdomainname -F key=system-locale  # (64-bit only)
   ```

2. **Check file/directory monitoring rules:**  
   ```bash
   sudo auditctl -l | grep -E "/etc/(issue|hosts|networks|network/|issue.net)" | grep "system-locale"
   ```  
   **Expected Output:**  
   ```bash
   -w /etc/issue -p wa -k system-locale
   -w /etc/issue.net -p wa -k system-locale
   -w /etc/hosts -p wa -k system-locale
   -w /etc/networks -p wa -k system-locale
   -w /etc/network/ -p wa -k system-locale
   ```

---

### **Step 6: Validate Rules File Structure**
**Purpose:** Ensure rules are stored persistently in the correct file.  

1. **Confirm the rules file exists:**  
   ```bash
   sudo ls -l /etc/audit/rules.d/*.rules
   ```  
   - Look for `50-system_local.rules` in the output.

2. **Check file content:**  
   ```bash
   sudo cat /etc/audit/rules.d/50-system_local.rules
   ```  
   - Verify all rules from Step 2 are present.

---

### **Step 7: Final Checks**
**Purpose:** Ensure no steps were missed.  

1. **Auditd service status:**  
   ```bash
   sudo systemctl status auditd
   ```  
   - Ensure it is `active (running)`.

2. **Test rule functionality (optional):**  
   - Trigger a change to `/etc/hosts`:  
     ```bash
     echo "# Test" | sudo tee -a /etc/hosts
     ```  
   - Check the audit log:  
     ```bash
     sudo ausearch -k system-locale | grep "/etc/hosts"
     ```  
   - A log entry should appear for the change.

---

**Notes:**  
- For 32-bit systems, omit `-F arch=b64` rules.  
- Rules in `/etc/audit/rules.d/` are preserved across reboots.  
- Use `auditctl -l` to troubleshoot missing rules.  

**Troubleshooting:**  
- If rules do not load, run `auditctl -R /etc/audit/rules.d/50-system_local.rules` to force-load them.  
- Ensure no typos in the `.rules` file (e.g., missing `-k` flags).  

**References:**  
- `man audit.rules`  
- CIS Benchmark guidelines for auditd configuration.