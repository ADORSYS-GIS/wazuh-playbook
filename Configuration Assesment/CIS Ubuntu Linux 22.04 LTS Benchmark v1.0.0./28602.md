# Audit Rule Playbook: Monitoring Session Initiation Events (Using `nano`)  

---

## **Objective**  
Configure audit rules to monitor changes to session files (`/var/run/utmp`, `/var/log/wtmp`, `/var/log/btmp`) using the `nano` text editor.  

---

## **Pre-Remediation Verification**  

### **Step 1: Check Current Audit Rules**  
Verify if the rules are already active:  
```bash  
auditctl -l | grep -E '/var/run/utmp|/var/log/wtmp|/var/log/btmp'  
```  
- **Expected Output**:  
  ```  
  -w /var/run/utmp -p wa -k session  
  -w /var/log/wtmp -p wa -k session  
  -w /var/log/btmp -p wa -k session  
  ```  
- **If all rules exist**: No action needed.  
- **If missing**: Proceed below.  

---

## **Remediation Steps**  

### **Step 2: Create/Edit Audit Rules File with `nano`**  
1. Open/Create the rules file in `/etc/audit/rules.d/`:  
   ```bash  
   sudo nano /etc/audit/rules.d/50-session.rules  
   ```  
2. **Add these lines** to the file:  
   ```  
   -w /var/run/utmp -p wa -k session  
   -w /var/log/wtmp -p wa -k session  
   -w /var/log/btmp -p wa -k session  
   ```  
3. **Save and Exit**:  
   - Press `Ctrl+O` to save.  
   - Press `Enter` to confirm.  
   - Press `Ctrl+X` to exit `nano`.  

**Notes**:  
- Replace `50-session.rules` with your preferred filename (must end in `.rules`).  
- Ensure no duplicate rules exist in other files (e.g., `audit.rules`).  

---

### **Step 3: Merge and Load Audit Rules**  
```bash  
sudo augenrules --load  
```  

---

### **Step 4: Restart the Audit Service**  
```bash  
sudo systemctl restart auditd  
```  

---

## **Post-Remediation Verification**  

### **Step 5: Confirm Rules Are Active**  
Re-run the auditctl check:  
```bash  
auditctl -l | grep -E '/var/run/utmp|/var/log/wtmp|/var/log/btmp'  
```  
- All three rules should appear.  

---

### **Step 6: Check Reboot Requirement**  
```bash  
if [[ $(auditctl -s | grep "enabled" | awk '{print $2}') -eq 2 ]]; then  
  echo "Reboot required to load rules."  
else  
  echo "No reboot required."  
fi  
```  
- **Reboot if prompted**.  

---

### **Step 7: Validate File Contents**  
Confirm the rules were added to your `.rules` file:  
```bash  
grep -h "session" /etc/audit/rules.d/50-session.rules  
```  
- Expected output matches the three rules added in Step 2.  

---

## **Notes**  
- **Reboot Requirement**: Required if `auditctl -s` shows `enabled=2`.  
- **Audit Logs**: Use `ausearch -k session` to review events.  
- **File Permissions**: Ensure rules files have strict permissions (e.g., `640`).  

**Outcome**:  
Session initiation events are now monitored for unauthorized access.