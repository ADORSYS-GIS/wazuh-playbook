# Manual Playbook: Monitor Sudoers Files with Audit Rules

## Purpose
Ensure all changes to `/etc/sudoers` and `/etc/sudoers.d/` are audited to detect unauthorized modifications to administrative privileges.

## Prerequisites
- **Access**: Root or sudo privileges.
- **Auditd Installed**: Confirm with `systemctl status auditd`.
- **Backup**: Backup existing audit rules before changes.

## Remediation Steps

### 1. Verify Current Audit Rules
Check if `/etc/sudoers` and `/etc/sudoers.d/` are already monitored:

```bash
auditctl -l | grep -E '^-w /etc/sudoers -p wa -k scope|^-w /etc/sudoers.d -p wa -k scope'
```
- **Expected Output:** Two lines matching the rules.
- **No Output:** Proceed with remediation.

### 2. Create or Modify Audit Rules
#### Option A: Create a New Rule File
Create a new rule file in /etc/audit/rules.d/:

```bash
printf -- "-w /etc/sudoers -p wa -k scope\n-w /etc/sudoers.d -p wa -k scope\n" | sudo tee /etc/audit/rules.d/50-sudoers-scope.rules
```
#### Option B: Append to Existing Rules
If rules exist but are incomplete:

```bash
echo "-w /etc/sudoers -p wa -k scope" | sudo tee -a /etc/audit/rules.d/50-scope.rules
echo "-w /etc/sudoers.d -p wa -k scope" | sudo tee -a /etc/audit/rules.d/50-scope.rules
```
### 3. Load the New Rules
Merge and apply rules without requiring a reboot (if possible):

```bash
sudo augenrules --load
```

### 4. Verify Rules Are Active
Check if rules are loaded:

```bash
auditctl -l | grep -E '^-w /etc/sudoers -p wa -k scope|^-w /etc/sudoers.d -p wa -k scope'
```
- **Expected Output:** Both rules appear.

### 5. Check if Reboot is Required
If auditd is not fully enabled, a reboot may be needed:

```bash
if [[ $(auditctl -s | grep "enabled") =~ "2" ]]; then
  echo "Reboot required to fully activate audit rules."
else
  echo "Rules loaded successfully without reboot."
fi
```

