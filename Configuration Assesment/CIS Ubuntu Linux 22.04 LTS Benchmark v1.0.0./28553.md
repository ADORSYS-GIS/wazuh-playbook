### Step-by-Step Playbook: Remove CUPS to Reduce Attack Surface

---

#### **Purpose**  
Ensure the Common Unix Print System (CUPS) is removed if the system does not require printing capabilities, thereby reducing potential attack vectors.

---

### **Step 1: Pre-Check – Verify CUPS Installation Status**
**Objective**: Confirm whether CUPS is installed on the system.

1. **Command 1**: Check package status using `dpkg-query` with formatting.  
   ```bash
   dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' cups
   ```
   - **Expected Output if CUPS is Not Installed**:  
     `No packages found matching cups`  
   - **Expected Output if CUPS is Installed**:  
     `cups    install ok installed    installed`

2. **Command 2**: Check detailed package status.  
   ```bash
   dpkg-query -s cups
   ```
   - **Expected Output if CUPS is Not Installed**:  
     `Package 'cups' is not installed and no info is available.`
   - **Expected Output if CUPS is Installed**:  
     `Status: install ok installed`

**Interpretation**:  
- If **both commands** indicate CUPS is **not installed**, no further action is needed.  
- If **either command** shows CUPS is **installed**, proceed to remediation.

---

### **Step 2: Remediation – Remove CUPS**
**Objective**: Uninstall CUPS and purge configuration files.

1. **Stop CUPS Service** (if running):  
   ```bash
   sudo systemctl stop cups
   sudo systemctl disable cups
   ```

2. **Remove CUPS Package**:  
   ```bash
   sudo apt purge cups -y
   ```

3. **Remove Orphaned Dependencies** (optional):  
   ```bash
   sudo apt autoremove -y
   ```

---

### **Step 3: Post-Remediation Verification**
**Objective**: Confirm CUPS is fully removed.

1. **Re-run Pre-Check Commands**:  
   ```bash
   dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' cups
   dpkg-query -s cups
   ```
   - **Expected Success Outputs**:  
     - `No packages found matching cups`  
     - `Package 'cups' is not installed and no info is available.`

---

### **Step 4: Additional Considerations**
1. **Check for Dependent Services**:  
   Ensure no critical services rely on CUPS (e.g., print queues, legacy applications).  
   ```bash
   systemctl list-dependencies | grep -i cups
   ```

2. **Verify Network Ports**:  
   Confirm port 631 (CUPS web interface) is no longer listening.  
   ```bash
   ss -tuln | grep ':631'
   ```
---

### **Final Notes**
- **Critical Systems**: If this is a shared server, ensure no users or applications require CUPS.  
- **Backup**: Backup configurations (`/etc/cups/`) before removal if future reinstallation is possible.  
- **Monitoring**: Monitor system logs post-removal for errors related to print jobs.  

--- 

**Outcome**: CUPS is removed, reducing the attack surface and complying with security best practices.