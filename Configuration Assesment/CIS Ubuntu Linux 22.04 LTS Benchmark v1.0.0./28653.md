### SSH Session Timeout Configuration Playbook  
**Issue:** Idle SSH sessions may lead to resource exhaustion or abuse.  
**Objective:** Configure `ClientAliveInterval` and `ClientAliveCountMax` to terminate idle connections per site policy (example: 45-second timeout).  

---

#### **Step 1: Access the SSH Configuration File**  
1. **Open the SSH server configuration file**  
   ```bash  
   sudo nano /etc/ssh/sshd_config  
   ```  
   *Note:* Replace `nano` with your preferred text editor (e.g., `vim`).  

---

#### **Step 2: Verify Current Settings**  
1. **Check if `ClientAliveInterval` and `ClientAliveCountMax` are configured**  
   Run:  
   ```bash  
   sudo grep -E "ClientAliveInterval|ClientAliveCountMax" /etc/ssh/sshd_config  
   ```  
   - If no output is returned, the parameters are not explicitly set (defaults: `ClientAliveInterval=0`, `ClientAliveCountMax=3`).  
   - If parameters exist, note their current values.  

---

#### **Step 3: Configure Timeout Values**  
1. **Set `ClientAliveInterval`**  
   - This value defines the interval (in seconds) after which the server sends a keepalive message to the client.  
   - Example: `ClientAliveInterval 15`  

2. **Set `ClientAliveCountMax`**  
   - This value defines how many unanswered keepalive messages are sent before disconnecting the client.  
   - Example: `ClientAliveCountMax 3` (15s * 3 = 45s total timeout).  

   **Add or modify lines in `/etc/ssh/sshd_config`:**  
   ```  
   ClientAliveInterval 15  
   ClientAliveCountMax 3  
   ```  
   *Note:* Replace values with your organization’s policy.  

---

#### **Step 4: Validate Syntax and Restart SSH Service**  
1. **Check for syntax errors**  
   ```bash  
   sudo sshd -t  
   ```  
   - Resolve any errors before proceeding.  

2. **Restart the SSH service**  
   ```bash  
   sudo systemctl restart sshd  # For systemd systems (most modern Linux)  
   # OR  
   sudo service ssh restart    # For SysVinit systems  
   ```  

---

#### **Step 5: Verify Configuration**  
1. **Confirm active settings**  
   ```bash  
   sudo sshd -T | grep -E "clientaliveinterval|clientalivecountmax"  
   ```  
   - Output should reflect the configured values (case-insensitive).  

2. **Test an SSH session**  
   - Open an SSH connection to the server.  
   - Leave the session idle for the configured timeout period (e.g., 45s).  
   - The session should automatically terminate after the threshold.  

---

#### **Step 6: Document and Monitor**  
1. **Document the changes**  
   - Record the new values, date, and responsible team member.  
2. **Monitor logs for issues**  
   - Check SSH logs for errors or unexpected disconnects:  
     ```bash  
     sudo tail -f /var/log/auth.log | grep sshd  
     ```  

---

#### **Rollback Plan**  
1. **Revert to original configuration**  
   - Restore the backup of `/etc/ssh/sshd_config`:  
     ```bash  
     sudo cp /etc/ssh/sshd_config.backup /etc/ssh/sshd_config  
     ```  
   - Restart the SSH service (Step 4.2).  

---

#### **Critical Notes**  
- **SSH Version Compatibility:**  
  - Confirm the server uses OpenSSH 8.2p1 or later to ensure idle users are **not** disconnected (pre-8.2p1 versions had a bug).  
  - Check the version with:  
    ```bash  
    sshd -V  
    ```  
- **Idle Connections ≠ Idle Users:**  
  - These settings terminate idle **connections** (no data transmitted), not idle **users** (e.g., a user logged in but not typing commands).  
- **TCPKeepAlive vs. ClientAlive:**  
  - `TCPKeepAlive` checks if the network connection is alive (spoofable).  
  - `ClientAlive` checks if the SSH client is responsive (encrypted, non-spoofable).  

---

**Example Configuration for 45-Second Timeout:**  
```  
ClientAliveInterval 15  # Server sends a check every 15 seconds  
ClientAliveCountMax 3   # After 3 missed checks (15s x 3 = 45s), terminate  
```  
Adjust values based on organizational policies.