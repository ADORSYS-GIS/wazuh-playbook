### Step-by-Step Playbook: Configure RSyslog File Permissions

#### **Objective**  
Ensure RSyslog creates log files with secure permissions (`$FileCreateMode 0640` or stricter).

---

### **Step 1: Verify Current Configuration**
**Purpose**: Check if `$FileCreateMode 0640` is already configured.

1. **Check `/etc/rsyslog.conf` and `/etc/rsyslog.d/` files**:
   ```bash
   sudo grep -r --include='*.conf' '^\s*$FileCreateMode' /etc/rsyslog.conf /etc/rsyslog.d/
   ```

2. **Expected Output**:
   - If compliant:  
     `$FileCreateMode 0640` (or stricter, e.g., `0600`).
   - If non-compliant: No output or a value like `0644`.

---

### **Step 2: Backup Configuration Files**
**Purpose**: Safeguard against unintended changes.
```bash
# Backup main configuration file
sudo cp /etc/rsyslog.conf /etc/rsyslog.conf.bak-$(date +%F)

# Backup all files in /etc/rsyslog.d/
sudo tar -czvf /etc/rsyslog.d_backup-$(date +%F).tar.gz /etc/rsyslog.d/*
```

---

### **Step 3: Configure `$FileCreateMode`**
**Purpose**: Set log file permissions to `0640`.

#### **A: Add to a Dedicated File (Recommended)**  
1. Create or edit a configuration file in `/etc/rsyslog.d/`:
   ```bash
   sudo nano /etc/rsyslog.d/50-default.conf
   ```

2. Insert the line:
   ```bash
   $FileCreateMode 0640
   ```

3. Save and exit (Ctrl+O → Enter → Ctrl+X).

#### **B: Modify `/etc/rsyslog.conf`**  
1. Open the main configuration file:
   ```bash
   sudo nano /etc/rsyslog.conf
   ```

2. Add or update the line:
   ```bash
   $FileCreateMode 0640
   ```

3. Save and exit.

---

### **Step 4: Restart RSyslog Service**
**Purpose**: Apply changes.
```bash
sudo systemctl restart rsyslog
```

---

### **Step 5: Validate Configuration**
1. **Verify the setting is active**:
   ```bash
   sudo grep -r '^\s*$FileCreateMode' /etc/rsyslog.conf /etc/rsyslog.d/
   ```

2. **Test Log File Permissions**:
   - Generate a test log message:
     ```bash
     logger "Test log for permissions"
     ```
   - Check the latest log file’s permissions:
     ```bash
     ls -l $(sudo grep -l "Test log for permissions" /var/log/*)
     ```
   - **Expected Permissions**: `-rw-r-----` (equivalent to `0640`).

---

### **Step 6: Troubleshooting**
**Issue**: Changes not applied.  
**Solution**:
1. Check for syntax errors:
   ```bash
   sudo rsyslogd -N1
   ```
2. Inspect RSyslog service status:
   ```bash
   sudo systemctl status rsyslog
   journalctl -u rsyslog --since "5 minutes ago"
   ```
3. Ensure no conflicting `$FileCreateMode` directives exist in other `.conf` files.

---

### **Final Output Example**
```plaintext
$ ls -l /var/log/syslog
-rw-r----- 1 syslog adm 12345 Jan 1 12:00 /var/log/syslog
```

**Success Criteria**:  
- `$FileCreateMode 0640` is present in configuration files.  
- Log files have permissions `0640` or stricter.  
- RSyslog service is running without errors.