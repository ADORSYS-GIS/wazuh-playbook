
## Create a Separate `/var` Partition

### Backup Entire Root Before Resizing

Before shrinking or resizing the root partition, it’s prudent to back up the entire root filesystem so you can restore if something goes wrong. Use your preferred method (disk image, filesystem snapshot, or rsync).

### 1. Preliminary Checks

#### a. Check Current `/var` Size on the Installed System
Before resizing or creating a new partition, note how much space `/var` is currently using and plan a suitable new partition size (allowing some headroom for growth).

1. Boot normally into your installed Ubuntu system.
2. Open a terminal and run:
   ```bash
   sudo du -sh /var
   sudo df -h /var
   ```

* `du -sh /var` show s the total size of existing data in `/var`.
* `df -h /var` shows the current filesystem usage and free space.

3. Based on these outputs, decide on a target size for the new `/var` partition. For example, if `/var` is currently 20 GiB, you might allocate 30 GiB or more, depending on expected growth.

---

### 2. Boot Live USB

1. **Boot from Ubuntu Live USB (Try Ubuntu):**

   * You cannot modify partitions on a mounted root in use by the running OS, so use a Live session.

2. **Launch GParted:**

   * From the Live Ubuntu desktop, open **GParted** (search “GParted” in the applications menu).

---

### 3. Partitioning with GParted

#### a. Identify and Shrink the Existing Root Partition

1. In GParted, locate your Ubuntu root partition (we’ll call it `<ROOT_PARTITION>`).

   * It might be labeled ext4 and you can confirm by matching size or mount points from `lsblk`.
2. Right-click `<ROOT_PARTITION>` → **Resize/Move**.
3. Decide how much space to free for `/var`.

   * Based on the earlier check (`du -sh /var`), free at least “current size + margin” (e.g., if `/var` used \~20 GiB, free ≥30 GiB).
   * In the **Free Space Following (MiB)** field, enter the needed amount in MiB (e.g., `30720` for \~30 GiB), or adjust the “New size” accordingly.
4. Click **Resize/Move**, then click the green checkmark (Apply All Operations). Wait for the operation to complete.

#### b. Create New Partition for `/var`

1. In the now-unallocated space (shown by GParted):

   * Right-click on **unallocated** → **New**.
   * For **New size (MiB)**, use a size at least as large as you planned (e.g., if you freed 30720 MiB, it should default to that). Adjust if needed.
   * Set **File system** to `ext4`.
   * (Optional) Set **Label** to something like `VAR_PART` or leave blank.
   * Click **Add**.
2. Click the green checkmark (Apply All Operations) to create and format the new partition.
3. Note the device name assigned to the new partition (e.g., `/dev/sdXN`). We will refer to it as `<NEW_VAR_PARTITION>`.

> **Note:** Use placeholders in your own commands: replace `<ROOT_PARTITION>` and `<NEW_VAR_PARTITION>` with the actual device paths you observe in GParted (e.g., `/dev/sda3`, `/dev/sda5`, or `/dev/nvme0n1p6`, etc).

---

### 4. Data Migration and `fstab` Update

1. **Find the UUID of the New Partition:**

   * In GParted, right-click `<NEW_VAR_PARTITION>` → **Information** → copy the **UUID**.
   * Alternatively in terminal:

     ```bash
     sudo blkid /dev/<NEW_VAR_PARTITION>
     ```

     and note the `UUID="..."`.

2. **Mount Partitions in Live USB Terminal:**

   ```bash
   sudo mkdir -p /mnt/ubuntu_root
   sudo mount /dev/<ROOT_PARTITION> /mnt/ubuntu_root
   sudo mkdir -p /mnt/new_var
   sudo mount /dev/<NEW_VAR_PARTITION> /mnt/new_var
   ```

3. **Copy Existing `/var` Data:**

   ```bash
   sudo rsync -avh --progress /mnt/ubuntu_root/var/ /mnt/new_var/
   ```

   * After copying, verify sizes:

     ```bash
     du -sh /mnt/ubuntu_root/var
     du -sh /mnt/new_var
     ```
   * Ensure the copied data size matches or is very close.

4. **Rename (Backup) Original `/var`:**

   ```bash
   sudo mv /mnt/ubuntu_root/var /mnt/ubuntu_root/var_old
   ```

   * This preserves the old data in case you need to revert. You can delete `var_old` after confirming the new `/var` works.

5. **Edit `fstab` in the Installed System:**

   ```bash
   sudo nano /mnt/ubuntu_root/etc/fstab
   ```

   * Add a new line for the `/var` partition. You can choose either:

     * **UUID entry** (more robust if device names change):

       ```
       UUID=<UUID_OF_NEW_VAR>    /var    ext4    defaults,nosuid,nodev    0   2
       ```
     * **Direct device path** (simpler but may break if disk order/naming changes):

       ```
       /dev/<NEW_VAR_PARTITION>    /var    ext4    defaults,nosuid,nodev    0   2
       ```
   * **Reasoning**:

     * **UUID**: Remains consistent even if device enumeration or disk ordering changes (e.g., adding/removing drives). Preferred for stability.
     * **Device path**: Easier to type in the short term, but if the kernel assigns different names later (e.g., `/dev/sda` becomes `/dev/sdb`), the system may fail to mount `/var`.
   * Save and exit (Ctrl+O, Enter; Ctrl+X).

6. **Unmount and Reboot:**

   ```bash
   sudo umount /mnt/new_var
   sudo umount /mnt/ubuntu_root
   sudo reboot
   ```

---

### 5. Post-Reboot Verification

1. After booting into your installed Ubuntu:

   ```bash
   df -h | grep "/var"
   ls -la /var
   ```

   * Confirm that `/var` is listed as its own mount point and usage reflects what was copied.
2. If all is working correctly and you no longer need the backup copy:

   ```bash
   sudo rm -rf /var_old
   ```

   * Only do this after you are confident services depending on `/var` run normally.

---

### Summary of Placeholder Conventions

* `<ROOT_PARTITION>`: the existing root filesystem partition on your Ubuntu installation (e.g., `/dev/sda3`, `/dev/nvme0n1p5`, etc.). Identify via `lsblk`, GParted, or `sudo fdisk -l`.
* `<NEW_VAR_PARTITION>`: the new partition you create for `/var` in the freed space (e.g., `/dev/sda5`, `/dev/nvme0n1p6`, etc.).
* `<UUID_OF_NEW_VAR>`: the filesystem UUID for `<NEW_VAR_PARTITION>`, obtained via GParted or `sudo blkid`.
* `<BACKUP_DESTINATION>`: path (local mount point or network location) where you store your backup (e.g., `/media/ubuntu/MyBackupDrive` or `user@server:/backups/ubuntu_var`).

> **Tips:**
>
> * Always double-check device names before running destructive operations.
> * Ensure you have a reliable backup before modifying partitions.
> * Plan the new partition size based on current `/var` usage plus growth expectations.
> * If you ever need to revert during testing, you can restore `/var_old` back to `/var` by reversing the `mv` and fstab entry.

