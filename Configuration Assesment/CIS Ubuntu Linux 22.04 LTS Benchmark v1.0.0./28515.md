## Create `/var/log/audit` Partition

### Preliminary Backup Step

Before proceeding, ensure you have a recent backup of critical data:

```bash
sudo rsync -avh --progress /var/log/audit /path/to/backup/varlogaudit_backup_
```

Verify the backup completed successfully before moving on.

### Phase 1: Prepare the Environment (Live USB)

1. **Boot from Ubuntu Live USB (Try Ubuntu):**

   * You cannot modify partitions that are in use by the running OS.

2. **Open GParted:**

   * Launch **GParted** from the Live Ubuntu desktop.

---

### Phase 2: Partitioning with GParted (Partition for `/var/log/audit`)

1. **Identify Your Existing Root Partition:**

   * Locate your Ubuntu root partition (e.g., `/dev/nvme0n1p5`).

2. **Shrink the Root Partition (if not already done):**

   * Right-click `/dev/nvme0n1p5` → **Resize/Move**.
   * Free up at least **5 GiB** for `/var/log/audit` (e.g., `5120 MiB`).
   * Click **Resize/Move**, then **Apply All Operations**.

3. **Create New Partition for `/var/log/audit`:**

   * In the freed space:

     * Right-click **unallocated** → **New**.
     * Set **New size (MiB)** to `5120` (for 5 GiB).
     * Set **File system** to `ext4`.
     * Set **Label** to `VARLOGAUDIT`.
     * Click **Add**, then **Apply All Operations**.

> **CIS Recommendation:** Mount options `nodev`, `nosuid`, `noexec` are strongly recommended for audit logs.

---

### Phase 3: Data Migration and `fstab` Configuration

1. **Identify the New `/var/log/audit` Device and UUID:**

   * After creation, GParted will label it (e.g., `/dev/nvme0n1p9`).
   * Right-click → **Information** → copy the **UUID**.

2. **Mount Partitions in Live USB Terminal:**

   ```bash
   sudo mkdir /mnt/ubuntu_root
   sudo mount /dev/nvme0n1p5 /mnt/ubuntu_root         # Mount existing root
   sudo mkdir /mnt/new_varlogaudit
   sudo mount /dev/nvme0n1p9 /mnt/new_varlogaudit       # Mount new /var/log/audit
   ```

3. **Copy `/var/log/audit` Data:**

   ```bash
   sudo rsync -avh --progress /mnt/ubuntu_root/var/log/audit/ /mnt/new_varlogaudit/
   ```

   * **Verify** sizes:

     ```bash
     du -sh /mnt/ubuntu_root/var/log/audit
     du -sh /mnt/new_varlogaudit
     ```

4. **Rename Original `/var/log/audit`:**

   ```bash
   sudo mv /mnt/ubuntu_root/var/log/audit /mnt/ubuntu_root/var/log/audit_old
   ```

   * Acts as a backup. After verifying, remove `/var/log/audit_old`.

5. **Update `fstab` of Installed System:**

   ```bash
   sudo nano /mnt/ubuntu_root/etc/fstab
   ```

   * Add an entry (replace `<UUID>` with the actual UUID or replace `UUID=<UUID>` with device name `/dev/nvme0n1pX`):

     ```
     UUID=<UUID>    /var/log/audit    ext4    defaults,nosuid,nodev,noexec    0   2
     ```
   * Save (Ctrl+O) and exit (Ctrl+X).

6. **Unmount and Reboot:**

   ```bash
   sudo umount /mnt/new_varlogaudit
   sudo umount /mnt/ubuntu_root
   sudo reboot
   ```

---

### Phase 4: Verification

1. After normal boot:

   ```bash
   df -h | grep "/var/log/audit"
   ls -la /var/log/audit
   ```

   * Ensure `/var/log/audit` is mounted separately and contains audit logs.

2. If successful, remove the backup:

   ```bash
   sudo rm -rf /var/log/audit_old
   ```

Your `/var/log/audit` directory is now on its own partition.
