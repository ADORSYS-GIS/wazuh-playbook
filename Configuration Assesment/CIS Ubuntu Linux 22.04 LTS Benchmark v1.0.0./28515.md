## Create a Separate `/var/log/audit` Partition

### Backup Entire Root Before Resizing

Before shrinking or resizing the root partition, it’s prudent to back up the entire root filesystem so you can restore if something goes wrong. Use your preferred method (disk image, filesystem snapshot, or rsync).

### 1. Preliminary Checks

#### a. Check Current `/var/log/audit` Size on the Installed System
Before creating a new partition, check how much data is in `/var/log/audit` and choose an appropriate size (with headroom for growth).

1. Boot normally into your installed Ubuntu system.
2. Open a terminal and run:
   ```bash
   sudo du -sh /var/log/audit
   sudo df -h /var/log/audit
   ```

* `du -sh /var/log/audit` shows total size of existing audit logs.
* `df -h /var/log/audit` shows filesystem usage and free space.

3. Based on these outputs, decide on a target size for the new `/var/log/audit` partition (e.g., if audit logs use \~3 GiB, you might allocate 5 GiB or more).

### 2. Boot Live USB 

1. **Boot from Ubuntu Live USB (Try Ubuntu):**

   * Required because you cannot modify partitions mounted by the running OS.
2. **Launch GParted:**

   * From the Live desktop, open **GParted**.

---

### 3. Partitioning with GParted

#### a. Identify and Shrink the Existing Root Partition (if needed)

1. In GParted, locate your Ubuntu root partition (`<ROOT_PARTITION>`).
2. If you haven’t already freed space for `/var/log/audit`, right-click `<ROOT_PARTITION>` → **Resize/Move**.
3. Free at least the size you planned (e.g., 5120 MiB for \~5 GiB). Enter that in **Free Space Following (MiB)**.
4. Click **Resize/Move**, then Apply All Operations.

#### b. Create New Partition for `/var/log/audit`

1. In the unallocated space:

   * Right-click **unallocated** → **New**.
   * Set **New size (MiB)** to your chosen size (e.g., `5120`).
   * Set **File system** to `ext4`.
   * (Optional) Set **Label** to `VARLOGAUDIT_PART` or leave blank.
   * Click **Add**.
2. Click the green checkmark (Apply All Operations) to create and format.
3. Note the device name assigned (e.g., `/dev/sdXN` or `/dev/nvme0n1pX`); refer to it as `<NEW_VARLOGAUDIT_PARTITION>`.

> **Note:** Use placeholders: replace `<ROOT_PARTITION>` and `<NEW_VARLOGAUDIT_PARTITION>` with actual device paths you see.

---

### 4. Data Migration and `fstab` Update

1. **Find the UUID of the New Partition:**

   * In GParted, right-click `<NEW_VARLOGAUDIT_PARTITION>` → **Information** → copy **UUID**.
   * Or in terminal:

     ```bash
     sudo blkid /dev/<NEW_VARLOGAUDIT_PARTITION>
     ```

     and note `UUID="..."`.

2. **Mount Partitions in Live USB Terminal:**

   ```bash
   sudo mkdir -p /mnt/ubuntu_root
   sudo mount /dev/<ROOT_PARTITION> /mnt/ubuntu_root
   sudo mkdir -p /mnt/new_varlogaudit
   sudo mount /dev/<NEW_VARLOGAUDIT_PARTITION> /mnt/new_varlogaudit
   ```

3. **Copy Existing `/var/log/audit` Data:**

   ```bash
   sudo rsync -avh --progress /mnt/ubuntu_root/var/log/audit/ /mnt/new_varlogaudit/
   ```

   * Verify sizes:

     ```bash
     du -sh /mnt/ubuntu_root/var/log/audit
     du -sh /mnt/new_varlogaudit
     ```
   * Ensure data matches or is very close.

4. **Rename (Backup) Original `/var/log/audit`:**

   ```bash
   sudo mv /mnt/ubuntu_root/var/log/audit /mnt/ubuntu_root/var/log/audit_old
   ```

   * Keeps a fallback. Delete `audit_old` after confirming success.

5. **Edit `fstab` in the Installed System:**

   ```bash
   sudo nano /mnt/ubuntu_root/etc/fstab
   ```

   * Add a line for `/var/log/audit`. You can choose:

     * **UUID entry** (robust if device names change):

       ```
       UUID=<UUID_OF_NEW_VARLOGAUDIT>    /var/log/audit    ext4    defaults,nosuid,nodev,noexec    0   2
       ```
     * **Direct device path** (simpler but may break if naming shifts):

       ```
       /dev/<NEW_VARLOGAUDIT_PARTITION>    /var/log/audit    ext4    defaults,nosuid,nodev,noexec    0   2
       ```
   * **Reasoning**:

     * **UUID**: Stable across reboots and disk-order changes; preferred for reliability.
     * **Device path**: Easier to type initially, but if disk enumeration changes, mount could fail.
   * Save and exit (Ctrl+O, Enter; Ctrl+X).

6. **Unmount and Reboot:**

   ```bash
   sudo umount /mnt/new_varlogaudit
   sudo umount /mnt/ubuntu_root
   sudo reboot
   ```

---

### 5. Post-Reboot Verification

1. After booting into your installed Ubuntu:

   ```bash
   df -h | grep "/var/log/audit"
   ls -la /var/log/audit
   ```

   * Confirm `/var/log/audit` is a separate mount with expected audit logs.
2. If all works, remove the backup copy:

   ```bash
   sudo rm -rf /var/log/audit_old
   ```

   * Only after verifying audit services log correctly to the new location.

---

### Summary of Placeholder Conventions

* `<ROOT_PARTITION>`: your existing root filesystem partition (e.g., `/dev/sda3`, `/dev/nvme0n1p5`).
* `<NEW_VARLOGAUDIT_PARTITION>`: the newly created partition for `/var/log/audit` (e.g., `/dev/sda8`, `/dev/nvme0n1p9`).
* `<UUID_OF_NEW_VARLOGAUDIT>`: filesystem UUID of `<NEW_VARLOGAUDIT_PARTITION>`, obtained via GParted or `blkid`.
* `<BACKUP_DESTINATION>`: path or mount point for backups (e.g., `/media/ubuntu/BackupDrive` or `user@server:/backups`).

> **Tips:**
>
> * Double-check device identifiers before destructive operations.
> * Ensure a reliable backup before making partition changes.
> * Choose partition size based on current `/var/log/audit` usage plus expected growth.
> * To revert during testing, restore `/var/log/audit_old` back to `/var/log/audit` and remove or comment out the fstab entry.

