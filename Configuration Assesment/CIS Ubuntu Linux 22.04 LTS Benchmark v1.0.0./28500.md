### Step-by-Step Playbook: Securing `/tmp` by Mounting as `tmpfs` with Restricted Options

---

#### **Objective**  
Configure `/tmp` as a separate `tmpfs` filesystem with secure mount options (`noexec`, `nosuid`, `nodev`) using either `/etc/fstab` or `systemd`'s `tmp.mount`. This prevents execution of malicious code and hard-link attacks.

---

### **Step 1: Verify Current `/tmp` Configuration**
Check how `/tmp` is currently mounted:
```bash
mount | grep /tmp
ls -ld /tmp  # Verify permissions (should be 1777)
```
- If it’s part of the root filesystem, proceed with remediation.
- If `/tmp` is already a separate `tmpfs` or partition, proceed to adjust options.

### **Step 2: Configure via `/etc/fstab`**
1. **Backup `/etc/fstab`:**
   ```bash
   sudo cp /etc/fstab /etc/fstab.bak
   ```

2. **Add or Update the `/tmp` Entry**  
   Open `/etc/fstab` and add:
   ```
   tmpfs  /tmp  tmpfs  rw,nosuid,nodev,noexec,relatime,size=2G  0  0
   ```
   - **Options Explained:**
     - `nosuid`: Blocks setuid binaries.
     - `nodev`: Ignores device files.
     - `noexec`: Prevents execution of binaries.
     - `size=2G`: Limits `/tmp` size to 2GB (adjust as needed).

    ```bash
    sudo nano /etc/fstab
    ```

    ---

    #### **3. Stop Services Using `/tmp`**
    Unmounting `/tmp` may fail if processes are using it. Stop critical services (optional):
    ```bash
    sudo systemctl stop snapd.service unattended-upgrades.service cron.service
    ```

    ---

    #### **4. Manually Mount `/tmp` as `tmpfs`**
    Force-unmount the existing `/tmp` (if part of the root filesystem) and mount it fresh:
    ```bash
    # Unmount (may fail if busy – proceed to Step 4 if needed)
    sudo umount /tmp

    # Mount manually
    sudo mount -t tmpfs -o rw,nosuid,nodev,noexec,relatime,size=2G tmpfs /tmp
    ```

    ---

    #### **5. Resolve "Target is Busy" Error**
    If unmounting fails because `/tmp` is in use:
    ```bash
    # Switch to single-user mode (minimal environment)
    sudo systemctl rescue

    # Now unmount and mount
    sudo umount /tmp
    sudo mount -t tmpfs -o rw,nosuid,nodev,noexec,relatime,size=2G tmpfs /tmp

    # Exit rescue mode
    exit
    ```

    ---

    #### **6. Test `/etc/fstab`**
    After manual mount succeeds, test if `/etc/fstab` works:
    ```bash
    sudo umount /tmp
    sudo mount -a  # This mounts all entries in /etc/fstab
    ```

    ---

    #### **7. Verify `/tmp` Mount**
    Check if `/tmp` is now a `tmpfs` filesystem:
    ```bash
    mount | grep /tmp
    ```
    Output should show:
    ```
    tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noexec,relatime,size=2G)
    ```

    ---

    #### **8. Set Permissions**
    Ensure `/tmp` has the sticky bit (permissions `1777`):
    ```bash
    sudo chmod 1777 /tmp
    ls -ld /tmp  # Should show "drwxrwxrwt"
    ```

    ---

    #### **9. Reboot and Confirm**
    Reboot to ensure `/tmp` mounts automatically:
    ```bash
    sudo reboot
    ```
    After reboot:
    ```bash
    mount | grep /tmp  # Confirm tmpfs is active
    ```

    ---

### **Step 3: Adjust options**
1. **Update the `/tmp` Entry**  
   Open `/etc/fstab` and add:
   ```
   tmpfs  /tmp  tmpfs  rw,nosuid,nodev,noexec,relatime,size=2G  0  0
   ```
   - **Options Explained:**
     - `nosuid`: Blocks setuid binaries.
     - `nodev`: Ignores device files.
     - `noexec`: Prevents execution of binaries.
     - `size=2G`: Limits `/tmp` size to 2GB (adjust as needed).

    ```bash
    sudo nano /etc/fstab
    ```

    ---
2. **Stop Services Using `/tmp`**
    Unmounting `/tmp` may fail if processes are using it. Stop critical services (optional):
    ```bash
    sudo systemctl stop snapd.service unattended-upgrades.service cron.service
    ```
    ---
3. **Test `/etc/fstab`**

    After manual mount succeeds, test if `/etc/fstab` works:
    ```bash
    sudo umount /tmp
    sudo mount -a  # This mounts all entries in /etc/fstab
    ```
    ---

4. **Verify `/tmp` Mount**

    Check if `/tmp` has the adequate options:

    ```bash
    mount | grep /tmp
    ```
    Output should show:
    ```
    tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noexec,relatime,size=2G)
    ```
---
5. **Set Permissions**

    Ensure `/tmp` has the sticky bit (permissions `1777`):
    ```bash
    sudo chmod 1777 /tmp
    ls -ld /tmp  # Should show "drwxrwxrwt"
    ```
---
6. **9. Reboot and Confirm**

    Reboot to ensure `/tmp` mounts automatically:
    ```bash
    sudo reboot
    ```
    After reboot:
    ```bash
    mount | grep /tmp  # Confirm tmpfs is active and options are correct
    ```

### **Summary**
By isolating `/tmp` as a `tmpfs` filesystem with `noexec`, `nosuid`, and `nodev`, you mitigate risks of code execution and hard-link attacks. Choose the configuration method (traditional `fstab` or systemd-based) that aligns with your environment. 

**NOTE: This resolves issues ID 28500-28503**