### Step-by-Step Playbook for Loopback Traffic Configuration with UFW

**Objective**: Ensure loopback traffic is only allowed on the loopback interface (lo) and denied on all other interfaces for both IPv4 (127.0.0.0/8) and IPv6 (::1).

---

#### **Step 1: Verify UFW Installation**
**Check**: Confirm UFW (Uncomplicated Firewall) is installed.  
**Command**:  
```bash
dpkg -s ufw
```  
**Expected Output**:  
```
Status: install ok installed
```  
**Remediation (if not installed)**:  
```bash
sudo apt update && sudo apt install ufw -y
```

---

#### **Step 2: Enable UFW**
**Check**: Ensure UFW is active.  
**Command**:  
```bash
sudo ufw status | grep "Status: active"
```  
**Remediation (if inactive)**:  
```bash
sudo ufw enable
```

---

#### **Step 3: Enable IPv6 Support in UFW**
**Check**: Ensure UFW manages IPv6 rules.  
**Command**:  
```bash
grep "IPV6=yes" /etc/default/ufw
```  
**Remediation (if IPv6 is disabled)**:  
1. Edit the UFW configuration file:  
   ```bash
   sudo nano /etc/default/ufw
   ```  
2. Set `IPV6=yes`.  
3. Reload UFW:  
   ```bash
   sudo ufw reload
   ```

---

#### **Step 4: Apply Loopback Interface Rules**
**Commands**:  
```bash
# Allow incoming/outgoing traffic on loopback interface (IPv4/IPv6)
sudo ufw allow in on lo
sudo ufw allow out on lo

# Block loopback traffic on non-loopback interfaces (IPv4)
sudo ufw deny in from 127.0.0.0/8

# Block loopback traffic on non-loopback interfaces (IPv6)
sudo ufw deny in from ::1
```

---

#### **Step 5: Validate Rules**
**Check**: Confirm all rules are applied correctly.  
**Command**:  
```bash
sudo ufw status verbose
```  

**Expected Output**:  
```plaintext
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), deny (routed)

To                         Action      From
--                         ------      ----
Anywhere on lo             ALLOW IN    Anywhere
Anywhere                   DENY IN     127.0.0.0/8
Anywhere (v6) on lo        ALLOW IN    Anywhere (v6)
Anywhere (v6)              DENY IN     ::1

To                         Action      From
--                         ------      ----
Anywhere                   ALLOW OUT   Anywhere on lo
Anywhere (v6)              ALLOW OUT   Anywhere (v6) on lo
```  

**Regex Checks**:  
1. `Anywhere \(v6\) on lo\s*ALLOW IN\s*Anywhere \(v6\)`  
2. `Anywhere \(v6\)\s*ALLOW OUT\s*Anywhere \(v6\) on lo`  
3. `Anywhere \(v6\)\s*DENY IN\s*::1`  
4. `Anywhere on lo\s*ALLOW IN\s*Anywhere`  
5. `Anywhere\s*DENY IN\s*127.0.0.0/8`  
6. `Anywhere\s*\t*ALLOW OUT\s*Anywhere on lo`  

---

#### **Step 6: Reload UFW (Optional)**
**Command**:  
```bash
sudo ufw reload
```  
**Purpose**: Ensure rules are applied persistently.

---

#### **Final Verification**
Re-run the checks to confirm compliance:  
```bash
sudo ufw status verbose
```  
Ensure all regex patterns from **Step 5** are present.

---

**Notes**:  
- If existing rules conflict, use `sudo ufw delete [RULE_NUMBER]` to remove them.  
- Test connectivity after applying rules (e.g., `ping 127.0.0.1` should work, but blocking on non-loopback interfaces).