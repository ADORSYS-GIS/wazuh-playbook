### Manual Step-by-Step Playbook: Monitoring Login/Logout Events via Auditd

---

**Objective**:  
Ensure auditd monitors login/logout events by tracking changes to `/var/log/lastlog` and `/var/run/faillock`.

---

#### **Step 1: Verify Current Audit Rules**
Check if the rules are already active in the audit subsystem.

```bash
auditctl -l | grep -E '/var/log/lastlog|/var/run/faillock'
```

- **Expected Output**:  
  If the rules exist, you will see:  
  ```
  -w /var/log/lastlog -p wa -k logins
  -w /var/run/faillock -p wa -k logins
  ```
  If not, proceed to Step 2.

---

#### **Step 2: Check Existing Configuration Files**
Inspect existing `.rules` files in `/etc/audit/rules.d/` for the required rules.

```bash
grep -rE '^-w\s+/var/log/lastlog\s+-p\s+wa\s+-k\s+logins|^-w\s+/var/run/faillock\s+-p\s+wa\s+-k\s+logins' /etc/audit/rules.d/
```

- **Expected Output**:  
  If the rules are found in any file, no further action is needed.  
  If not, proceed to Step 3.

---

#### **Step 3: Create or Edit Audit Rules File**
Add the rules to a new or existing `.rules` file (e.g., `50-login.rules`).

1. Create/edit the file:  
   ```bash
   nano /etc/audit/rules.d/50-login.rules
   ```

2. Add the following lines:  
   ```
   -w /var/log/lastlog -p wa -k logins
   -w /var/run/faillock -p wa -k logins
   ```

3. Save and exit the editor.

---

#### **Step 4: Merge and Load Audit Rules**
Load the new rules into the active audit configuration.

```bash
augenrules --load
```

- **Expected Output**:  
  No errors. Verify with:  
  ```bash
  auditctl -l | grep -E '/var/log/lastlog|/var/run/faillock'
  ```

---

#### **Step 5: Verify Audit Service Status**
Ensure `auditd` is running and enabled.

```bash
systemctl status auditd && systemctl is-enabled auditd
```

- **If not running**:  
  ```bash
  systemctl start auditd && systemctl enable auditd
  ```

---

#### **Step 6: Check If Reboot Is Required**
Determine if a reboot is needed to apply rules persistently.

```bash
if [[ $(auditctl -s | grep "enabled") =~ "2" ]]; then echo "Reboot required to load rules"; fi
```

- **If output states "Reboot required"**:  
  Schedule a reboot or run:  
  ```bash
  reboot
  ```

---

**Final Validation**:  
After reboot (if needed), re-run Step 1 and Step 2 to confirm the rules are active and persistent.

---

**Notes**:  
- Use `auditctl -s` to check the `enabled` flag: `1` means rules are loaded, `2` means they require a reboot.  
- Ensure all `.rules` files in `/etc/audit/rules.d/` have correct syntax (no typos).  
- Test rules with `ausearch -k logins` after triggering a login/logout event.