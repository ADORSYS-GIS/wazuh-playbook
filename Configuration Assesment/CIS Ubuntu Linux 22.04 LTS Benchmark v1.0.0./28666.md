**Step-by-Step Playbook: Configure Password Maximum Age (PASS_MAX_DAYS)**

**Objective**: Ensure all user passwords expire after a maximum of 365 days, and `PASS_MAX_DAYS` is greater than `PASS_MIN_DAYS`.

---

### **1. Pre-Assessment Checks**
**Purpose**: Verify current configurations for `PASS_MAX_DAYS` and `PASS_MIN_DAYS`.

#### **1.1 Check `/etc/login.defs`**
- **Command**:
  ```bash
  grep -Ei '^\s*PASS_MAX_DAYS|^\s*PASS_MIN_DAYS' /etc/login.defs
  ```
- **Expected Output**:
  ```
  PASS_MAX_DAYS 365
  PASS_MIN_DAYS 1
  ```
- **Action**:
  - If `PASS_MAX_DAYS > 365` or missing, proceed to remediation.
  - If `PASS_MIN_DAYS >= PASS_MAX_DAYS`, adjust `PASS_MIN_DAYS` (e.g., `1`).

#### **1.2 Check User Password Expiry in `/etc/shadow`**
- **Command**:
  ```bash
  awk -F: '($2 != "*" && $2 != "!*") {print $1, $5}' /etc/shadow | awk '$2 > 365 || $2 == "" {print}'
  ```
- **Expected Output**: No users listed.
- **Action**: If users are listed, proceed to update their `maxdays`.

---

### **2. Remediation**
**Purpose**: Enforce `PASS_MAX_DAYS=365` globally and for all users.

#### **2.1 Update `/etc/login.defs`**
- **Command**:
  ```bash
  sudo sed -i 's/^\(PASS_MAX_DAYS\s*\).*/\1365/' /etc/login.defs
  sudo sed -i 's/^\(PASS_MIN_DAYS\s*\).*/\11/' /etc/login.defs   # If PASS_MIN_DAYS â‰¥ PASS_MAX_DAYS
  ```
- **Verification**:
  ```bash
  grep 'PASS_MAX_DAYS' /etc/login.defs
  ```

#### **2.2 Update Existing Users**
- **Identify Users**:
  ```bash
  sudo awk -F: '($2 != "*" && $2 != "!*" && $5 > 365) {print $1}' /etc/shadow > users_to_update.txt
  ```
- **Update Users**:
  ```bash
  while read user; do sudo chage --maxdays 365 "$user"; done < users_to_update.txt
  ```
- **Verification**:
  ```bash
  sudo chage -l <user> | grep "Maximum number of days"
  ```

---

### **3. Post-Remediation Validation**
**Purpose**: Confirm all configurations are compliant.

#### **3.1 Validate `/etc/login.defs`**
- Ensure `PASS_MAX_DAYS=365` and `PASS_MIN_DAYS < PASS_MAX_DAYS`.

#### **3.2 Validate Users in `/etc/shadow`**
- **Command**:
  ```bash
  sudo awk -F: '($2 != "*" && $2 != "!*") {print $1, $5}' /etc/shadow | awk '$2 > 365 {print}'
  ```
- **Expected Output**: No users listed.

---

### **4. Handling Exceptions**
- **Service Accounts**: Exclude system accounts (e.g., `nobody`, `root`) if required by policy.
- **Automation**: Use tools like Ansible or Puppet to enforce configurations at scale.

---

### **5. Documentation**
- **Record Changes**: Log updated users and old/new settings.
- **Schedule Reviews**: Recheck every 6 months or after major system changes.

---

**Notes**:
- Changes to `/etc/login.defs` apply only to **new users**. Existing users must be updated manually.
- Use `chage --maxdays 365` to override user-specific settings.