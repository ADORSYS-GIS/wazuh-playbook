### SSH Configuration Assessment Playbook: Disable Root Login via SSH

---

#### **Objective**  
Ensure the SSH daemon is configured to prevent direct root logins, enforcing individual user authentication and auditability.

---

### **Step 1: Pre-Remediation Verification**

#### **1.1 Check Current SSH Configuration**
**Command:**  
```bash
sudo sshd -T | grep -i "permitrootlogin"
```  
**Expected Output:**  
`permitrootlogin no`  

**Action:**  
- If the output matches `permitrootlogin no`, root logins are already disabled. Proceed to Step 1.2 to validate the config file.  
- If the output shows `yes`, `prohibit-password`, or is missing, proceed to remediation.

---

#### **1.2 Validate `/etc/ssh/sshd_config` File**  
**Command:**  
```bash
sudo grep -Ei "^\s*PermitRootLogin\s+" /etc/ssh/sshd_config
```  
**Expected Output:**  
`PermitRootLogin no`  

**Action:**  
- If the line exists and is set to `no`, no further action is needed.  
- If the line is set to `yes`, `prohibit-password`, or is commented out (`#PermitRootLogin ...`), proceed to remediation.

---

### **Step 2: Remediation**

#### **2.1 Backup the SSH Configuration File**  
```bash
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
```

#### **2.2 Edit `/etc/ssh/sshd_config`**  
1. Open the file with a text editor (e.g., `vim`, `nano`):  
   ```bash
   sudo nano /etc/ssh/sshd_config
   ```  
2. Locate the `PermitRootLogin` line:  
   - If it exists, modify it to:  
     ```text
     PermitRootLogin no
     ```  
   - If it does not exist, add the line to the file:  
     ```text
     PermitRootLogin no
     ```  
3. Save and exit the editor.

#### **2.3 Validate Syntax Before Restarting SSH**  
```bash
sudo sshd -t
```  
**Action:**  
- If no errors are shown, proceed.  
- If errors appear, revert changes using the backup file and investigate.

#### **2.4 Restart the SSH Service**  
```bash
sudo systemctl restart sshd   # For systems using systemd
# OR
sudo service ssh restart     # For SysVinit systems
```

**⚠️ Warning:**  
Ensure you have an alternative access method (e.g., console access) in case of misconfiguration.

---

### **Step 3: Post-Remediation Validation**

#### **3.1 Confirm Runtime Configuration**  
```bash
sudo sshd -T | grep -i "permitrootlogin"
```  
**Expected Output:**  
`permitrootlogin no`

#### **3.2 Confirm Config File Update**  
```bash
sudo grep -Ei "^\s*PermitRootLogin\s+no" /etc/ssh/sshd_config
```  
**Expected Output:**  
`PermitRootLogin no`

---

### **Step 4: Logging and Documentation**  
- Log the change in your system change management tool.  
- Example log entry:  
  ```text
  [Date] Disabled SSH root logins by setting PermitRootLogin=no in /etc/ssh/sshd_config. Service restarted.
  ```

---

### **Troubleshooting**  
- **SSH Service Fails to Restart:**  
  - Revert to the backup:  
    ```bash
    sudo cp /etc/ssh/sshd_config.bak /etc/ssh/sshd_config
    sudo systemctl restart sshd
    ```  
  - Investigate syntax with `sshd -t`.  

- **Root User Lockout:**  
  Use console access or a privileged user with `sudo su -` to restore access.

---

### **Compliance References**  
- **Rationale:** Ensures audit trails for individual admin actions.  
- **Regulations:** Aligns with CIS Benchmarks, NIST 800-53, and PCI-DSS.  

---

**Approval:**  
Change reviewed by: [Name/Title]  
Date: [Date]  

**Revision History:**  
- v1.0 [Date]: Initial playbook created.