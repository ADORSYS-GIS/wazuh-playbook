### Step-by-Step Playbook: Enabling AppArmor at Boot Time via GRUB

---

#### **Objective**:  
Ensure AppArmor is enabled at boot time in the GRUB configuration to prevent its controls from being overridden.

---

### **1. Verify the Bootloader**
**Purpose**: Confirm the system uses GRUB as the bootloader.  
**Steps**:  
1. Check for GRUB configuration files:  
   ```bash
   ls /boot/grub/grub.cfg  # Common location for GRUB2 configurations
   ```  
   - If the file exists, proceed.  
   - If not, check for alternative bootloaders (e.g., LILO) and follow equivalent steps (not covered here).

---

### **2. Check Current Kernel Boot Parameters**  
**Purpose**: Ensure `apparmor=1` and `security=apparmor` are present.  
**Steps**:  
1. View the current kernel command line:  
   ```bash
   cat /proc/cmdline
   ```  
2. Validate both parameters exist:  
   ```bash
   grep -E 'apparmor=1|security=apparmor' /proc/cmdline
   ```  
   - **If both parameters are present**: No further action required.  
   - **If missing**: Proceed to remediation.

---

### **3. Edit the GRUB Configuration**  
**Purpose**: Add AppArmor parameters to the kernel command line.  
**Steps**:  
1. Open `/etc/default/grub` with root privileges:  
   ```bash
   sudo nano /etc/default/grub
   ```  
2. Locate the line starting with `GRUB_CMDLINE_LINUX=`.  
3. Append `apparmor=1 security=apparmor` to the existing parameters.  
   - **Example**:  
     Original Line:  
     ```bash
     GRUB_CMDLINE_LINUX=""
     ```  
     Modified Line:  
     ```bash
     GRUB_CMDLINE_LINUX="apparmor=1 security=apparmor"
     ```  
4. Save and exit the editor.

---

### **4. Update GRUB Configuration**  
**Purpose**: Apply changes to the bootloader.  
**Steps**:  
1. Run the command to regenerate the GRUB configuration:  
   ```bash
   sudo update-grub
   ```  
   - **Note**: On some systems, this may be `grub2-mkconfig -o /boot/grub2/grub.cfg`.

---

### **5. Reboot the System**  
**Purpose**: Load the updated kernel command line.  
**Steps**:  
```bash
sudo reboot
```

---

### **6. Post-Reboot Verification**  
**Purpose**: Confirm parameters are active and AppArmor is enabled.  
**Steps**:  
1. Check the kernel command line again:  
   ```bash
   cat /proc/cmdline | grep -E 'apparmor=1|security=apparmor'
   ```  
   - Both parameters should appear in the output.  
2. Verify AppArmor is running:  
   ```bash
   sudo systemctl status apparmor
   ```  
   - Expected output: `Active: active (exited)`.  
3. Check AppArmor profiles:  
   ```bash
   sudo aa-status
   ```  
   - Ensure profiles are loaded and in enforce/complain mode.

---

### **7. Troubleshooting**  
- **Issue**: Parameters missing after reboot.  
  **Solution**:  
  - Confirm `/etc/default/grub` was edited correctly.  
  - Ensure `update-grub` was run before rebooting.  

- **Issue**: AppArmor service not running.  
  **Solution**:  
  - Manually start AppArmor:  
    ```bash
    sudo systemctl start apparmor
    ```  
  - Enable it permanently:  
    ```bash
    sudo systemctl enable apparmor
    ```

---

### **Summary**  
By ensuring AppArmor is enabled in the GRUB configuration, you prevent unauthorized overrides of its security controls. This playbook guarantees the system complies with the required security baseline.