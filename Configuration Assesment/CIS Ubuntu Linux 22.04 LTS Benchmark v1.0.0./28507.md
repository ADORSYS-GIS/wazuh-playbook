## Create `/var/tmp` Partition

### Preliminary Backup Step

Before proceeding, ensure you have a recent backup of critical data:

```bash
sudo rsync -avh --progress /var/tmp /path/to/backup/vartmp_backup_
```

Verify the backup completed successfully before moving on.

### Phase 1: Prepare the Environment (Live USB)

1. **Boot from Ubuntu Live USB (Try Ubuntu):**

   * You cannot modify partitions in use by the running OS.

2. **Open GParted:**

   * Launch **GParted** from the Live Ubuntu desktop.

---

### Phase 2: Partitioning with GParted (Partition for `/var/tmp`)

1. **Identify Your Existing Root Partition:**

   * Locate your main Ubuntu root (e.g., `/dev/nvme0n1p5`).

2. **Shrink the Root Partition (if not already done):**

   * Right-click on `/dev/nvme0n1p5` → **Resize/Move**.
   * Free up at least **5 GiB** (e.g., enter `5120 MiB` for the new partition).
   * Click **Resize/Move** → **Apply All Operations**.

3. **Create New Partition for `/var/tmp`:**

   * In the freed space:

     * Right-click **unallocated** → **New**.
     * Set **New size (MiB)** to `5120` for 5 GiB.
     * Set **File system** to `ext4`.
     * Set **Label** to `VARTMP`.
     * Click **Add**, then **Apply All Operations**.

> **Note:** You should apply the shrink before creating this partition if the root hasn’t already been resized for `/var` and `/home`.

---

### Phase 3: Data Migration and `fstab` Configuration

1. **Identify the New `/var/tmp` Device and UUID:**

   * After creation, GParted will label it (e.g., `/dev/nvme0n1p7`).
   * Right-click → **Information** → copy the **UUID**.

2. **Mount Partitions in Live USB Terminal:**

   ```bash
   sudo mkdir /mnt/ubuntu_root
   sudo mount /dev/nvme0n1p5 /mnt/ubuntu_root         # Mount existing root
   sudo mkdir /mnt/new_vartmp
   sudo mount /dev/nvme0n1p7 /mnt/new_vartmp           # Mount new /var/tmp
   ```

3. **Copy `/var/tmp` Data:**

   ```bash
   sudo rsync -avh --progress /mnt/ubuntu_root/var/tmp/ /mnt/new_vartmp/
   ```

   * **Verify** sizes:

     ```bash
     du -sh /mnt/ubuntu_root/var/tmp
     du -sh /mnt/new_vartmp
     ```

4. **Rename Original `/var/tmp`:**

   ```bash
   sudo mv /mnt/ubuntu_root/var/tmp /mnt/ubuntu_root/var/tmp_old
   ```

   * Acts as a backup. After confirming success, you may remove `/var/tmp_old`.

5. **Update `fstab` of Installed System:**

   ```bash
   sudo nano /mnt/ubuntu_root/etc/fstab
   ```

   * Add an entry (replace `<UUID>` with the actual UUID or replace `UUID=<UUID>` with device name `/dev/nvme0n1pX`):


     ```
     UUID=<UUID>    /var/tmp    ext4    defaults,nosuid,nodev,noexec    0   2
     ```
   * Save (Ctrl+O) and exit (Ctrl+X).

6. **Unmount and Reboot:**

   ```bash
   sudo umount /mnt/new_vartmp
   sudo umount /mnt/ubuntu_root
   sudo reboot
   ```

---

### Phase 4: Verification

1. After booting normally:

   ```bash
   df -h | grep "/var/tmp"
   ls -la /var/tmp
   ```

   * Ensure `/var/tmp` is mounted separately and contains your data.

2. If correct, remove the backup folder:

   ```bash
   sudo rm -rf /var/tmp_old
   ```

Your `/var/tmp` directory is now on its own partition.
