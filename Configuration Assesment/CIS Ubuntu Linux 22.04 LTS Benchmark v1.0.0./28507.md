
## Create a Separate `/var/tmp` Partition

### (Optional) Backup Entire Root Before Resizing

Before shrinking or resizing the root partition, it’s prudent to back up the entire root filesystem so you can restore if something goes wrong. Use your preferred method (disk image, filesystem snapshot, or rsync).

### 1. Preliminary Checks

#### a. Check Current `/var/tmp` Size on the Installed System
Before creating a new partition, see how much data is in `/var/tmp` and decide on an appropriate size (with some headroom).

1. Boot normally into your installed Ubuntu system.
2. Open a terminal and run:
   ```bash
   sudo du -sh /var/tmp
   sudo df -h /var/tmp
   ```

* `du -sh /var/tmp` shows total size of existing data.
* `df -h /var/tmp` shows filesystem usage and free space.

3. Based on these outputs, choose a target size for the new `/var/tmp` partition (e.g., if `/var/tmp` uses 2 GiB, you might allocate 5 GiB or more).


### 2. Boot Live USB

1. **Boot from Ubuntu Live USB (Try Ubuntu):**

   * Necessary because you can't modify mounted partitions of the running OS.
2. **Launch GParted:**

   * From the Live desktop, open **GParted**.

---

### 3. Partitioning with GParted

#### a. Identify and Shrink the Existing Root Partition (if needed)

1. In GParted, locate your Ubuntu root partition (`<ROOT_PARTITION>`).
2. If you haven’t already freed space for `/var/tmp`, right-click `<ROOT_PARTITION>` → **Resize/Move**.
3. Free at least the size you planned (e.g., 5120 MiB for \~5 GiB). In **Free Space Following (MiB)** enter that value.
4. Click **Resize/Move**, then Apply All Operations. (Green checkmark)

#### b. Create New Partition for `/var/tmp`

1. In the unallocated space:

   * Right-click **unallocated** → **New**.
   * Set **New size (MiB)** to your chosen size (e.g., `5120`).
   * Set **File system** to `ext4`.
   * (Optional) Set **Label** to `VARTMP_PART` or leave blank.
   * Click **Add**.
2. Click the green checkmark (Apply All Operations) to create and format.
3. Note the device name assigned (e.g., `/dev/sdXN`); refer to it as `<NEW_VARTMP_PARTITION>`.

> **Note:** Use placeholders: replace `<ROOT_PARTITION>` and `<NEW_VARTMP_PARTITION>` with actual device paths you see (e.g., `/dev/sda3`, `/dev/sda6`).

---

### 4. Data Migration and `fstab` Update

1. **Find the UUID of the New Partition:**

   * In GParted, right-click `<NEW_VARTMP_PARTITION>` → **Information** → copy **UUID**.
   * Or in terminal:

     ```bash
     sudo blkid /dev/<NEW_VARTMP_PARTITION>
     ```

     and note `UUID="..."`.

2. **Mount Partitions in Live USB Terminal:**

   ```bash
   sudo mkdir -p /mnt/ubuntu_root
   sudo mount /dev/<ROOT_PARTITION> /mnt/ubuntu_root
   sudo mkdir -p /mnt/new_vartmp
   sudo mount /dev/<NEW_VARTMP_PARTITION> /mnt/new_vartmp
   ```

3. **Copy Existing `/var/tmp` Data:**

   ```bash
   sudo rsync -avh --progress /mnt/ubuntu_root/var/tmp/ /mnt/new_vartmp/
   ```

   * Verify sizes:

     ```bash
     sudo du -sh /mnt/ubuntu_root/var/tmp
     sudo du -sh /mnt/new_vartmp
     ```
   * Ensure data matches or is very close.

4. **Rename (Backup) Original `/var/tmp`:**

   ```bash
   sudo mv /mnt/ubuntu_root/var/tmp /mnt/ubuntu_root/var/tmp_old
   ```

   * Keeps a fallback. Delete `var/tmp_old` after confirming success.

5. **Edit `fstab` in the Installed System:**

   ```bash
   sudo nano /mnt/ubuntu_root/etc/fstab
   ```

   * Add a line for `/var/tmp`. You can choose:

     * **UUID entry** (robust if device names change):

       ```
       UUID=<UUID_OF_NEW_VARTMP>    /var/tmp    ext4    defaults,nosuid,nodev,noexec    0   0
       ```
     * **Direct device path** (simpler but may break if naming shifts):

       ```
       /dev/<NEW_VARTMP_PARTITION>    /var/tmp    ext4    defaults,nosuid,nodev,noexec    0   0
       ```
   * **Reasoning**:

     * **UUID**: Stable across reboots, unaffected by disk order changes. Preferred for reliability.
     * **Device path**: Easier to type initially, but if disk enumeration changes, mount could fail.
   * Save and exit (Ctrl+O, Enter; Ctrl+X).

6. **Unmount and Reboot:**

   ```bash
   sudo umount /mnt/new_vartmp
   sudo umount /mnt/ubuntu_root
   sudo reboot
   ```

---

### 5. Post-Reboot Verification

1. After booting into your installed Ubuntu:

   ```bash
   df -h | grep "/var/tmp"
   ls -la /var/tmp
   ```

   * Confirm `/var/tmp` is a separate mount with expected contents.
2. If all works, remove the backup copy:

   ```bash
   sudo rm -rf /var/tmp_old
   ```

   * Only after verifying services and temporary files behave normally.

---

### Summary of Placeholder Conventions

* `<ROOT_PARTITION>`: your existing root filesystem partition (e.g., `/dev/sda3`, `/dev/nvme0n1p5`).
* `<NEW_VARTMP_PARTITION>`: the newly created partition for `/var/tmp` (e.g., `/dev/sda6`, `/dev/nvme0n1p7`).
* `<UUID_OF_NEW_VARTMP>`: filesystem UUID of `<NEW_VARTMP_PARTITION>`, from GParted or `blkid`.
* `<BACKUP_DESTINATION>`: path or mount point where backups are stored (e.g., `/media/ubuntu/BackupDrive` or `user@server:/backups`).

> **Tips:**
>
> * Double-check device identifiers before destructive operations.
> * Ensure reliable backup before partition changes.
> * Choose partition size based on current `/var/tmp` usage plus growth expectations.
> * To revert during testing, restore `/var/tmp_old` back to `/var/tmp` and remove the fstab line.

