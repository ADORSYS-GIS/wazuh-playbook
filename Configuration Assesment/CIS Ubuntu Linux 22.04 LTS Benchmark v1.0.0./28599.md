# Manual Playbook: Audit System Time Changes

## Purpose
To detect and log unauthorized modifications to system time and date settings, which could indicate malicious activity or attempts to subvert audit logging.

## Prerequisites
- **Access**: Root privileges required
- **System Type**: Confirm architecture (32-bit or 64-bit)
- **Auditd**: Must be installed and running (`systemctl status auditd`)
- **Backup**: Existing audit rules should be backed up

## Remediation Steps

### 1. Verify Current Audit Rules
Check if time-change rules already exist:

```bash
auditctl -l | grep -E 'time-change|/etc/localtime'
```
**Compliant:** Should show rules for:

 - System calls (adjtimex, settimeofday, clock_settime)

 - /etc/localtime file changes

**Non-Compliant:** Proceed with remediation

### 2. Create Time Change Audit Rules
For 64-bit Systems:
```bash
cat << EOF | sudo tee /etc/audit/rules.d/50-time-change.rules
# Monitor time-related system calls
-a always,exit -F arch=b64 -S adjtimex,settimeofday,clock_settime -k time-change
-a always,exit -F arch=b32 -S adjtimex,settimeofday,clock_settime -k time-change

# Monitor local time file modifications
-w /etc/localtime -p wa -k time-change
EOF
```
For 32-bit Systems:

```bash
cat << EOF | sudo tee /etc/audit/rules.d/50-time-change.rules
# Monitor time-related system calls (including stime)
-a always,exit -F arch=b32 -S adjtimex,settimeofday,clock_settime,stime -k time-change

# Monitor local time file modifications
-w /etc/localtime -p wa -k time-change
EOF
```
### 3. Load New Audit Rules
```bash
sudo augenrules --load
sudo auditctl -R /etc/audit/rules.d/50-time-change.rules
```
### 4. Verify Rules Activation
```bash
auditctl -l | grep -E 'time-change'
```
Expected Output:

```
-a always,exit -S adjtimex,settimeofday,clock_settime -F arch=b64 -F key=time-change
-a always,exit -S adjtimex,settimeofday,clock_settime -F arch=b32 -F key=time-change
-w /etc/localtime -p wa -k time-change
```

### 5. Check Reboot Requirement
```bash
if [[ $(auditctl -s | grep "enabled") =~ "2" ]]; then
  echo "REBOOT REQUIRED to fully activate rules"
else
  echo "Rules loaded successfully (no reboot needed)"
fi
```