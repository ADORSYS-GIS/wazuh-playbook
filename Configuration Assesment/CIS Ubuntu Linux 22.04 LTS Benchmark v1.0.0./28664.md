**Step-by-Step Playbook: Configure yescrypt Password Hashing**

**Objective**: Ensure the system uses yescrypt for password hashing, enhancing security against brute-force attacks.

**Pre-requisites**:
- Root or sudo access.
- Backup current configurations.
- Test in a non-production environment first.

---

### **1. Pre-Checks: Verify Current Configuration**

**a. Check `/etc/login.defs`:**
```bash
grep -iP '^\s*ENCRYPT_METHOD\s+' /etc/login.defs
```
- **Expected Output**: `ENCRYPT_METHOD yescrypt`
- If output differs, proceed to remediation.

**b. Check `/etc/pam.d/common-password`:**
```bash
grep -P '^\s*password\s+.*pam_unix\.so.*(\syescrypt|\ssha512|\smd5|\sbigcrypt|\ssha256|\sblowfish)\s*' /etc/pam.d/common-password
```
- **Expected Output**: *No lines should match*.  
- If lines match (e.g., `sha512`), proceed to remediation.

---

### **2. Backup Configuration Files**

```bash
sudo cp /etc/login.defs /etc/login.defs.bak
sudo cp /etc/pam.d/common-password /etc/pam.d/common-password.bak
```

---

### **3. Update `/etc/login.defs`**

**a. Edit the file:**
```bash
sudo nano /etc/login.defs
```

**b. Locate `ENCRYPT_METHOD`**:
- If it exists, modify its value to `yescrypt`.
- If it doesnâ€™t exist, add:
  ```bash
  ENCRYPT_METHOD yescrypt
  ```

**c. Save and exit**.

---

### **4. Update `/etc/pam.d/common-password`**

**a. Open the file**:
```bash
sudo nano /etc/pam.d/common-password
```

**b. Find the `pam_unix.so` line** in the password section:
- Example original line:  
  `password [success=1 default=ignore] pam_unix.so sha512 obscure use_authtok`

**c. Remove the hashing algorithm** (e.g., `sha512`, `md5`):  
- Modified line:  
  `password [success=1 default=ignore] pam_unix.so obscure use_authtok`

**d. Ensure no other `pam_unix.so` lines specify an algorithm**.

**e. Save and exit**.

---

### **5. Validate Changes**

**a. Confirm `ENCRYPT_METHOD`**:
```bash
grep -iP '^\s*ENCRYPT_METHOD\s+yescrypt' /etc/login.defs
```

**b. Confirm no algorithms in PAM**:
```bash
grep -P '^\s*password\s+.*pam_unix\.so.*(\syescrypt|\ssha512|\smd5)' /etc/pam.d/common-password
```
- No output expected.

---

### **6. Test Password Change**

**a. Create a test user** (optional):
```bash
sudo useradd testuser
```

**b. Set a password**:
```bash
sudo passwd testuser
```

**c. Verify hash in `/etc/shadow`**:
```bash
sudo grep testuser /etc/shadow
```
- The hash should start with `$y$` (indicating yescrypt).

---

### **7. Enforce Password Reset for All Users**

**a. Notify users** to change passwords immediately.  
**b. Force expiration** (optional):
```bash
sudo chage -d 0 [username]
```

---

### **8. Rollback Plan (If Issues Arise)**

**a. Restore backups**:
```bash
sudo mv /etc/login.defs.bak /etc/login.defs
sudo mv /etc/pam.d/common-password.bak /etc/pam.d/common-password
```

**b. Notify users** to reset passwords again if needed.

---

**Notes**:
- **Critical**: Test configurations in a staging environment before production.
- Monitor authentication logs post-change:  
  `tail -f /var/log/auth.log`